@{
    ViewData["Title"] = "Home Page";

}
@using TodoApp.Model.Database
@model TodoApp.Host.Models.IndexViewModel

<h2 class="display-5">Your TODOs</h2>

<div class="row mb-sm-2 no-gutters">
    <form action="/Home/Index" class="form-inline col-6">
        <input name="isCompleted" value="@(Model.IsCompleted == true ? "true" : (Model.IsCompleted == false ? "false" : "null"))" type="hidden" />
        <input value="@Model.SearchString"
               class="form-control mr-sm-2"
               type="search"
               name="searchString"
               placeholder="Search"
               aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>

    <form action="/Home/AddTodo" class="form-inline col-6 justify-content-end" method="post">
        <input type="text" class="form-control mr-sm-2 min descriptionInput" name="newItemDescription" placeholder="Enter new TODO description">
        <button class="btn btn-outline-secondary my-2 my-sm-0" type="submit">Add TODO</button>
    </form>
</div>

<div class="row mb-sm-2">
    <form action="/Home/Index" class="ml-3">
        <input name="pageSize" value="@Model.PageSize" type="hidden" />
        <input name="searchString" value="@Model.SearchString" type="hidden" />
        <input name="isCompleted" value="null" type="hidden" />
        <button type="submit" class="btn btn-secondary @(Model.IsCompleted == null ? "active" : "")">All</button>
    </form>
    <form action="/Home/Index" class="ml-1">
        <input name="pageSize" value="@Model.PageSize" type="hidden" />
        <input name="searchString" value="@Model.SearchString" type="hidden" />
        <input name="isCompleted" value="true" type="hidden" />
        <button type="submit" class="btn btn-secondary @(Model.IsCompleted == true ? "active": "")">Completed</button>
    </form>
    <form action="/Home/Index" class="ml-1">
        <input name="pageSize" value="@Model.PageSize" type="hidden" />
        <input name="searchString" value="@Model.SearchString" type="hidden" />
        <input name="isCompleted" value="false" type="hidden" />
        <button type="submit" class="btn btn-secondary @(Model.IsCompleted == false ? "active" : "")">Active</button>
    </form>
</div>

<div class="container">
    @foreach (TodoItem todo in Model.TodoItems)
    {
        <div class="row todoItemRow">
            <button type="button"
                    name="@(!todo.IsCompleted ? "edit-button-"+todo.Id : "")"
                    @(todo.IsCompleted ? "disabled" : "")
                    onclick="onEditButtonClick(@todo.Id)"
                    class="btn btn-primary btn-sm rounded-0 todoItemButton">
                <i class="fa fa-edit"></i>
            </button>

            <button type="button"
                    name="save-button-@todo.Id"
                    onclick="onSaveButtonClick(@todo.Id)"
                    class="btn btn-success btn-sm rounded-0 todoItemButton"
                    style="display: none;">
                <i class="fa fa-save"></i>
            </button>

            <button type="button"
                    name="cancel-edit-button-@todo.Id"
                    onclick="onCancelEditButtonClick(@todo.Id)"
                    class="btn btn-warning btn-sm rounded-0 todoItemButton"
                    style="display: none;">
                <i class="fa fa-times"></i>
            </button>

            <button type="button"
                    class="btn btn-danger btn-sm rounded-0 todoItemButton"
                    name="delete-button-@todo.Id"
                    data-toggle="modal"
                    data-todo-id="@todo.Id"
                    data-target="#deleteTodoModal">
                <i class="fa fa-trash"></i>
            </button>

            <form action="/Home/CompleteTodo" method="post">
                <input type="hidden" name="id" value="@todo.Id" />
                <input name="page" value="@(Model.Page)" type="hidden" />
                <input name="pageSize" value="@Model.PageSize" type="hidden" />
                <input name="searchString" value="@Model.SearchString" type="hidden" />
                <input name="isCompleted" value="@(Model.IsCompleted == true ? "true" : (Model.IsCompleted == false ? "false" : "null"))" type="hidden" />

                <button type="submit"
                        class="btn btn-success btn-sm rounded-0 todoItemButton ml-3"
                        name="@(!todo.IsCompleted ? "complete-button-"+todo.Id : "")"
                        @(todo.IsCompleted ? "disabled" : "")>
                    <i class="fa fa-check"></i>
                </button>

                <label data-todo-id="@todo.Id" for="@todo.Id">@todo.Description</label>
                <input type="text"
                       name="edit-todo-description-@todo.Id"
                       data-todo-id="@todo.Id"
                       value="@todo.Description"
                       style="display: none;"
                       class="form-control-sm descriptionInput" />
            </form>
        </div>
    }
</div>

@if (Model.TotalNumberOfItems > Model.PageSize)
{
    <footer class="page-footer font-small blue pt-4">
        <nav>
            <div class="pagination">
                <form action="/Home/Index" method="get">
                    <input name="page" value="@(Model.Page-1)" type="hidden" />
                    <input name="pageSize" value="@Model.PageSize" type="hidden" />
                    <input name="searchString" value="@Model.SearchString" type="hidden" />
                    <input name="isCompleted" value="@Model.IsCompleted" type="hidden" />
                    <button class="page-item page-link" type="submit">
                        <span aria-hidden="true">&laquo;</span>
                    </button>
                </form>

                @for (int pageNumber = 0; pageNumber * Model.PageSize <= Model.TotalNumberOfItems; pageNumber++)
                {
                    <form action="/Home/Index" method="get">
                        <input name="page" value="@(pageNumber)" type="hidden" />
                        <input name="pageSize" value="@Model.PageSize" type="hidden" />
                        <input name="searchString" value="@Model.SearchString" type="hidden" />
                        <input name="isCompleted" value="@Model.IsCompleted" type="hidden" />
                        <button class="page-item page-link" type="submit">@(pageNumber+1)</button>
                    </form>
                }

                <form action="/Home/Index" method="get">
                    <input name="page" value="@(Model.Page >= (Model.TotalNumberOfItems / Model.PageSize) ? Model.Page : Model.Page+1)" type="hidden" />
                    <input name="pageSize" value="@Model.PageSize" type="hidden" />
                    <input name="searchString" value="@Model.SearchString" type="hidden" />
                    <input name="isCompleted" value="@Model.IsCompleted" type="hidden" />
                    <button class="page-item page-link" type="submit">
                        <span aria-hidden="true">&raquo;</span>
                    </button>
                </form>
            </div>
        </nav>
    </footer>
}

<div class="modal fade" id="deleteTodoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Delete TODO item</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this TODO item?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <form action="/Home/DeleteTodo" method="post">
                    <input type="hidden" name="id" />
                    <input name="page" value="@Model.Page" type="hidden" />
                    <input name="pageSize" value="@Model.PageSize" type="hidden" />
                    <input name="searchString" value="@Model.SearchString" type="hidden" />
                    <input name="isCompleted" value="@(Model.IsCompleted == true ? "true" : (Model.IsCompleted == false ? "false" : "null"))" type="hidden" />
                    <button class="btn btn-primary" type="submit">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>
